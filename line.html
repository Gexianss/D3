<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>

    <style>
        #tooltip {
            position: absolute;
            padding: 10px;
            background-color: rgba(241, 35, 35, 0.8);
            color: white;
            border-radius: 5px;
            pointer-events: none;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="tooltip" class="hidden"></div>
    </div>
    <script src="d3.v7.js"></script>
    <script type="module">

        // const aapl = FileAttachment("aapl.csv").csv({typed: true})
        // Declare the chart dimensions and margins.

        let aapl = []
        d3.json("generated_data2.json").then(data => {
            aapl = data.map(d => ({ ...d, date: new Date(d.date) })); // Convert date strings to Date objects

            const width = 1500;
            const height = 500;
            const marginTop = 20;
            const marginRight = 30;
            const marginBottom = 30;
            const marginLeft = 40;



            // Declare the x (horizontal position) scale.
            const x = d3.scaleUtc(d3.extent(aapl, d => d.date), [marginLeft, width - marginRight]);

            // Declare the y (vertical position) scale.
            const y = d3.scaleLinear([10, d3.max(aapl, d => d.close)], [height - marginBottom, marginTop]);

            // Declare the line generator.
            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.close));

            // Create the SVG container.
            const svg = d3.create("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", [0, 0, width, height])
                .attr("style", "max-width: 100%; height: auto; height: intrinsic;");

            // Add the x-axis.
            svg.append("g")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0));

            // Add the y-axis, remove the domain line, add grid lines and a label.
            svg.append("g")
                .attr("transform", `translate(${marginLeft},0)`)
                .call(d3.axisLeft(y).ticks(height / 40))
                .call(g => g.select(".domain").remove())
                .call(g => g.selectAll(".tick line").clone()
                    .attr("x2", width - marginLeft - marginRight)
                    .attr("stroke-opacity", 0.1))
                .call(g => g.append("text")
                    .attr("x", -marginLeft)
                    .attr("y", 10)
                    .attr("fill", "currentColor")
                    .attr("text-anchor", "start")
                    .text("â†‘ Daily close ($)"));

            // Append a path for the line.
            svg.append("path")
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", line(aapl));

            // Append the SVG element.
            container.append(svg.node());

            const tooltip = d3.select("#tooltip");

            svg.selectAll("circle")
                .data(aapl)
                .enter().append("circle")
                .attr("cx", d => x(d.date))
                .attr("cy", d => y(d.close))
                .attr("r", 3)
                .on("mouseover", (event, d) => {
                    tooltip.html(`<strong>Date:</strong> ${d.date.toDateString()}<br><strong>Close:</strong> $${d.close}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 20) + "px")
                        .classed("hidden", false);
                })
                .on("mouseout", () => {
                    tooltip.classed("hidden", true);
                });
        }).catch(error => {
            console.error('Error loading JSON data: ', error)
        })



    </script>
</body>

</html>